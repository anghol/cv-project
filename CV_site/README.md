# Сайт поиска дизайнов машинной вышивки по текстовому описанию

Это веб-приложение на **Flask**, которое позволяет выполнять **поиск дизайнов машинной вышивки по текстовому описанию**. Вместо простого поиска по ключевым словам, система понимает смысл вашего запроса и с помощью общего пространства эмбеддингов находит наиболее релевантные дизайны.

## Структура проекта

Проект организован следующим образом:

  * **`app.py`**: Основной файл Flask-приложения. Содержит всю логику:
      * Инициализация модели RuCLIP и FAISS-индекса.
      * Функции для загрузки, объединения и кэширования данных о дизайнах.
      * Маршрутизация для веб-страниц (`/` для поиска, `/product/<id>` для деталей дизайна).
      * Логика обработки поисковых запросов, вычисления схожести и фильтрации/сортировки результатов.
  * **`data/`**: Директория для данных проекта:
      * `products.csv`: Входной CSV-файл с метаданными о дизайнах вышивки (название, описание, цена, исходный URL, характеристики).
      * `embeddings_ruclip_finetuned.pkl`: Файл, содержащий предрассчитанные векторные представления (эмбеддинги) изображений дизайнов.
      * `ruclip_finetuned.pt`: Веса додобученной на дизайнах машинной вышивки модели ruClip.
  * **`static/`**: Статические файлы веб-приложения:
      * `images/`: Изображения дизайнов.
      * `css/`: CSS-файлы для стилизации интерфейса.
      * `js/`: JavaScript-файлы.
  * **`templates/`**: Шаблоны HTML, используемые Flask:
      * `index.html`: Главная страница для выполнения поиска.
      * `product.html`: Страница для отображения детальной информации о конкретном дизайне.

## Установка и запуск

1.  **Клонируйте репозиторий:**

    ```bash
    git clone https://github.com/anghol/cv-project.git
    cd cv-project/CV-site
    ```

2.  **Создайте и активируйте виртуальное окружение:**

    ```bash
    python3 -m venv .venv
    source .venv/bin/activate  
    ```

3.  **Установите зависимости:**

    ```bash
    pip install -r requirements.txt
    ```

4.  **Подготовьте файлы данных:**

      * Скачайте файлы из https://disk.360.yandex.ru/d/xxPLZzqZ2ZvnOw и переметсите их в соответствии с указанной выше структурой проекта.
      * Распакуйте zip-архивы с изображениями в папку `static/images/`, (итоговые изображения должны лежать в папках `static/images/embroteka_imgs`, `static/images/royal_present`, `static/images/royal_present_2`, `static/images/royal_present_3`, `static/images/royal_present_4`).

5.  **Запуск приложения Flask**

    ```bash
    python app.py
    ```

  * **Первый запуск** займёт больше времени, так как приложение обработает и объединит данные, а также построит FAISS-индекс. Эти результаты будут кэшированы на диске.
  * **Последующие запуски** будут значительно быстрее, поскольку приложение будет загружать кэшированные файлы.

После успешного запуска приложение будет доступно по адресу: `http://localhost:5000`.

### Доступ к приложению на удалённом сервере через SSH-туннель

Если вы запускаете приложение на удалённом сервере, используйте SSH-туннелирование для доступа к нему через ваш локальный браузер:

```bash
ssh -L 8888:localhost:5000 your_login@your_server_ip -p your_ssh_port
```

  * `-L 8888:localhost:5000`: Перенаправляет трафик с **локального порта 8888** на **порт 5000 удалённого сервера** (где работает Flask-приложение).
  * `your_login@your_server_ip`: Ваше имя пользователя и IP-адрес удалённого сервера.
  * `-p your_ssh_port`: SSH-порт удалённого сервера (если он не стандартный 22).

После установки туннеля вы сможете открыть приложение в своём локальном браузере по адресу `http://localhost:8888`.
